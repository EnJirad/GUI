local Xlib = {}

function Xlib:CreateShadow(parent)
    local Shadow = Instance.new("ImageLabel")
    Shadow.Name = "Shadow"
    Shadow.Size = UDim2.new(1, 10, 1, 10)
    Shadow.Position = UDim2.new(0, -5, 0, -5)
    Shadow.Image = "rbxassetid://1316045217"
    Shadow.BackgroundTransparency = 1
    Shadow.BorderSizePixel = 0
    Shadow.ZIndex = 0
    Shadow.Parent = parent

    return Shadow
end

function Xlib:CreateFrame(properties)
    local frame = Instance.new("Frame")
    for property, value in pairs(properties) do
        frame[property] = value
    end
    return frame
end

function Xlib:CreateTextLabel(properties)
    local textLabel = Instance.new("TextLabel")
    for property, value in pairs(properties) do
        textLabel[property] = value
    end
    return textLabel
end

function Xlib:CreateButton(properties)
    local button = Instance.new("TextButton")
    for property, value in pairs(properties) do
        button[property] = value
    end
    return button
end

function Xlib:MakeWindow(config)
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = config.Name or "XlibScreenGui"
    ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    
    local MainFrame = self:CreateFrame({
        Size = UDim2.new(0, 400, 0, 300),
        Position = UDim2.new(0.5, -200, 0.5, -150),
        BackgroundColor3 = Color3.fromRGB(240, 240, 240),
        BorderSizePixel = 0,
        Active = true,
        Draggable = true,
        Parent = ScreenGui,
    })
    
    self:CreateShadow(MainFrame)
    
    local TitleBar = self:CreateFrame({
        Size = UDim2.new(1, 0, 0, 30),
        BackgroundColor3 = Color3.fromRGB(50, 130, 184),
        BorderSizePixel = 0,
        Parent = MainFrame,
    })
    
    local TitleLabel = self:CreateTextLabel({
        Size = UDim2.new(1, -60, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        Text = config.Name or "Xlib UI",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 1,
        Font = Enum.Font.GothamBold,
        TextSize = 18,
        Parent = TitleBar,
    })
    
    local MinimizeButton = self:CreateButton({
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(1, -55, 0, 5),
        Text = "_",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundColor3 = Color3.fromRGB(50, 130, 184),
        Font = Enum.Font.GothamBold,
        TextSize = 14,
        Parent = TitleBar,
    })
    
    local CloseButton = self:CreateButton({
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(1, -30, 0, 5),
        Text = "X",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundColor3 = Color3.fromRGB(244, 67, 54),
        Font = Enum.Font.GothamBold,
        TextSize = 14,
        Parent = TitleBar,
    })
    
    local TabFrame = self:CreateFrame({
        Size = UDim2.new(0, 120, 1, -30),
        Position = UDim2.new(1, 0, 0, 30),
        BackgroundColor3 = Color3.fromRGB(240, 240, 240),
        BorderSizePixel = 0,
        Parent = MainFrame,
    })
    
    local ContentFrame = self:CreateFrame({
        Size = UDim2.new(1, -120, 1, -30),
        Position = UDim2.new(0, 0, 0, 30),
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BorderSizePixel = 0,
        Parent = MainFrame,
    })
    
    MinimizeButton.MouseButton1Click:Connect(function()
        MainFrame.Visible = not MainFrame.Visible
    end)
    
    CloseButton.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)
    
    return {
        MainFrame = MainFrame,
        TabFrame = TabFrame,
        ContentFrame = ContentFrame,
    }
end

function Xlib:MakeTab(config)
    local TabButton = self:CreateButton({
        Size = UDim2.new(1, 0, 0, 30),
        BackgroundColor3 = Color3.fromRGB(50, 130, 184),
        Text = config.Name,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Font = Enum.Font.Gotham,
        TextSize = 14,
        Parent = config.Parent.TabFrame,
    })
    
    local ToggleContainer = self:CreateFrame({
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Parent = config.Parent.ContentFrame,
        Visible = false,
    })
    
    TabButton.MouseButton1Click:Connect(function()
        for _, child in pairs(config.Parent.ContentFrame:GetChildren()) do
            if child:IsA("Frame") then
                child.Visible = false
            end
        end
        ToggleContainer.Visible = true
    end)
    
    return {
        ToggleContainer = ToggleContainer
    }
end

function Xlib:MakeToggle(config)
    local Toggle = self:CreateButton({
        Size = UDim2.new(1, -20, 0, 30),
        Position = UDim2.new(0, 10, 0, (#config.Parent.ToggleContainer:GetChildren() - 1) * 40 + 10),
        Text = config.Name,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundColor3 = Color3.fromRGB(50, 130, 184),
        Font = Enum.Font.Gotham,
        TextSize = 14,
        Parent = config.Parent.ToggleContainer,
    })
    
    local UICorner = self:CreateFrame({
        CornerRadius = UDim.new(0, 5),
        Parent = Toggle,
    })
    
    local state = config.Default or false
    Toggle.MouseButton1Click:Connect(function()
        state = not state
        config.Callback(state)
        Toggle.BackgroundColor3 = state and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(50, 130, 184)
    end)
end

return Xlib
